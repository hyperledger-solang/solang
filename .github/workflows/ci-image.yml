name: Build and push ci image
on: [workflow_dispatch]
jobs:
  build-push-ci-image:
    runs-on: ubuntu-20.04
    steps:
    - name: Checkout sources
      uses: actions/checkout@v1
    - run: docker build -f build/ci.dockerfile -t ghcr.io/hyperledger-labs/solang:ci .
    - name: Push to github container registry
      if: ${{ github.repository_owner == 'hyperledger-labs' && github.event_name == 'push' && github.ref == 'refs/heads/main' }}
      run: |
          echo ${{ secrets.GITHUB_TOKEN }} | docker login ghcr.io -u $GITHUB_ACTOR --password-stdin
          docker push ghcr.io/hyperledger-labs/solang:ci
